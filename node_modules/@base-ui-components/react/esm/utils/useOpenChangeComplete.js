import { useAnimationsFinished } from './useAnimationsFinished.js';
import { useEnhancedEffect } from './useEnhancedEffect.js';
import { useEventCallback } from './useEventCallback.js';
import { useLatestRef } from './useLatestRef.js';

/**
 * Calls the provided function when the CSS open/close animation or transition completes.
 */
export function useOpenChangeComplete(parameters) {
  const {
    open,
    ref,
    onComplete: onCompleteParam
  } = parameters;
  const openRef = useLatestRef(open);
  const onComplete = useEventCallback(onCompleteParam);
  const runOnceAnimationsFinish = useAnimationsFinished(ref, open);
  useEnhancedEffect(() => {
    runOnceAnimationsFinish(() => {
      if (open === openRef.current) {
        onComplete();
      }
    });
  }, [open, onComplete, runOnceAnimationsFinish, openRef]);
}